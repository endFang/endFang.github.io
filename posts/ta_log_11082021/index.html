<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>TA Log 11082021 | After1995</title>
<meta name=keywords content="shader,unity">
<meta name=description content="Blom like an artist:
Bloom Like an Artist
Circular Progress Bar https://bgolus.medium.com/progressing-in-circles-13452434fdb9
ATan vs. ATan2 $$ \tan{\alpha} = \frac{\sin{\alpha}}{\cos{\alpha}} $$
and we have
Quadrant Angle sin cos tan ------------------------------------------------- I 0 < α < π/2 + + + II π/2 < α < π + - - III π < α < 3π/2 - - + IV 3π/2 < α < 2π - + - Only knowing tangent doesn&rsquo;t give exact quadrant, so we need atan2().">
<meta name=author content="Kyle Fang">
<link rel=canonical href=https://endfang.github.io/posts/ta_log_11082021/>
<meta name=google-site-verification content="XYZabc">
<meta name=yandex-verification content="XYZabc">
<meta name=msvalidate.01 content="XYZabc">
<link crossorigin=anonymous href=/assets/css/stylesheet.min.9f1d947375927e9847272b1f4e9be81336f539e513bf04d52cade31f81cad1af.css integrity="sha256-nx2Uc3WSfphHJysfTpvoEzb1OeUTvwTVLK3jH4HK0a8=" rel="preload stylesheet" as=style>
<link rel=preload href=/apple-touch-icon.png as=image>
<script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://endfang.github.io/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://endfang.github.io/favicon-16x16.ico>
<link rel=icon type=image/png sizes=32x32 href=https://endfang.github.io/favicon-32x32.ico>
<link rel=apple-touch-icon href=https://endfang.github.io/apple-touch-icon.png>
<link rel=mask-icon href=https://endfang.github.io/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.88.1">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:rgba(255, 255, 255, 0.84);--secondary:rgba(255, 255, 255, 0.56);--tertiary:rgba(255, 255, 255, 0.16);--content:rgba(255, 255, 255, 0.74);--hljs-bg:#2e2e33;--code-bg:#37383e;--border:#333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css integrity=sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X crossorigin=anonymous>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js integrity=sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4 crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js integrity=sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa crossorigin=anonymous onload=renderMathInElement(document.body)></script>
<meta property="og:title" content="TA Log 11082021">
<meta property="og:description" content="Blom like an artist:
Bloom Like an Artist
Circular Progress Bar https://bgolus.medium.com/progressing-in-circles-13452434fdb9
ATan vs. ATan2 $$ \tan{\alpha} = \frac{\sin{\alpha}}{\cos{\alpha}} $$
and we have
Quadrant Angle sin cos tan ------------------------------------------------- I 0 < α < π/2 + + + II π/2 < α < π + - - III π < α < 3π/2 - - + IV 3π/2 < α < 2π - + - Only knowing tangent doesn&rsquo;t give exact quadrant, so we need atan2().">
<meta property="og:type" content="article">
<meta property="og:url" content="https://endfang.github.io/posts/ta_log_11082021/"><meta property="og:image" content="https://endfang.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-11-08T00:01:24+08:00">
<meta property="article:modified_time" content="2021-11-08T00:01:24+08:00"><meta property="og:site_name" content="After1995">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://endfang.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E">
<meta name=twitter:title content="TA Log 11082021">
<meta name=twitter:description content="Blom like an artist:
Bloom Like an Artist
Circular Progress Bar https://bgolus.medium.com/progressing-in-circles-13452434fdb9
ATan vs. ATan2 $$ \tan{\alpha} = \frac{\sin{\alpha}}{\cos{\alpha}} $$
and we have
Quadrant Angle sin cos tan ------------------------------------------------- I 0 < α < π/2 + + + II π/2 < α < π + - - III π < α < 3π/2 - - + IV 3π/2 < α < 2π - + - Only knowing tangent doesn&rsquo;t give exact quadrant, so we need atan2().">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://endfang.github.io/posts/"},{"@type":"ListItem","position":3,"name":"TA Log 11082021","item":"https://endfang.github.io/posts/ta_log_11082021/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"TA Log 11082021","name":"TA Log 11082021","description":"Blom like an artist:\nBloom Like an Artist\nCircular Progress Bar https://bgolus.medium.com/progressing-in-circles-13452434fdb9\nATan vs. ATan2 $$ \\tan{\\alpha} = \\frac{\\sin{\\alpha}}{\\cos{\\alpha}} $$\nand we have\nQuadrant Angle sin cos tan ------------------------------------------------- I 0 \u0026lt; α \u0026lt; π/2 + + + II π/2 \u0026lt; α \u0026lt; π + - - III π \u0026lt; α \u0026lt; 3π/2 - - + IV 3π/2 \u0026lt; α \u0026lt; 2π - + - Only knowing tangent doesn\u0026rsquo;t give exact quadrant, so we need atan2().","keywords":["shader","unity"],"articleBody":"Blom like an artist:\nBloom Like an Artist\nCircular Progress Bar https://bgolus.medium.com/progressing-in-circles-13452434fdb9\nATan vs. ATan2 $$ \\tan{\\alpha} = \\frac{\\sin{\\alpha}}{\\cos{\\alpha}} $$\nand we have\nQuadrant Angle sin cos tan ------------------------------------------------- I 0 α π/2 + + + II π/2 α π + - - III π α 3π/2 - - + IV 3π/2 α 2π - + - Only knowing tangent doesn’t give exact quadrant, so we need atan2().\natan2(() takes 2 arguments, which is the projection of a vector with length v and angle $\\alpha$ on the y and x axis\n$$ y = v \\cdot \\sin{\\alpha} \\\nx = v \\cdot \\cos{\\alpha} \\\ny/x = \\tan{\\alpha}\n$$\natan2() can tells 4 quadrant.\nTo implement a circular progress bar, we can use atan2().\nFirst, we need to calculate UV to angle:\nhalf angle = atan2(i.uv.x * -2.0 + 1.0, i.uv.y * -2.0 + 1.0); This will make uv to 4 quadrants and calculate the current position’s angle.\natan2() returns the radian between -pi to pi, we should convert angle into [0.0, 1.0].\nhalf range = angle / (UNITY_PI * 2.0) + 0.5; Finally we can compare it with the progress value.\nAnother approach Remap uv to -1 to +1 range so 0 is centered. Then we calculate progress to radian angle and create a rotation matrix.\nThe idea behind vertical and diagonal mask was to compare if the value is below 0. If it’s below 0, then it is filled part.\nTo figure this out, think both vertical and diagonal masks as a complete image, not just one pixel. When I increase or decrease the progress, shader rotates the diagonal mask. By combining vertical and diagonal masks, some values will become zero.\nIt worth to mention that the rotation matrix in 2D is :\n$$ \\begin{bmatrix}\n\\cos{\\theta} \u0026 \\sin{\\theta} \\\n-\\sin{\\theta} \u0026 \\cos{\\theta}\n\\end{bmatrix} $$\n\"CircularBarRotatedMask\" { Properties { _Frac (\"Progress Bar Value\", Range(0,1)) = 1.0 [NoScaleOffset] _AlphaTex (\"Alpha\", 2D) = \"White\" {} _FillColor (\"Fill Color\", Color) = (1,1,1,1) _BackColor (\"Back Color\", Color) = (0,0,0,1) [Toggle(SMOOTHSTEP)] _Smoothstep (\"Use Smoothstep\", Float) = 0.0 } SubShader { Tags {\"Queue\"=\"Transparent\" \"IgnoreProjector\"=\"True\" \"RenderType\"=\"Transparent\" \"PreviewType\"=\"Plane\"} ZWrite Off Blend SrcAlpha OneMinusSrcAlpha Pass { CGPROGRAM #pragma vertex vert #pragma fragment frag #pragma shader_feature SMOOTHSTEP #include \"UnityCG.cginc\" // Direct3D compiled stats: // vertex shader: // 12 math // fragment shader: // 13 math, 1 texture w/o smoothstep // 18 math, 1 texture w/ smoothstep half _Frac; fixed4 _FillColor; fixed4 _BackColor; sampler2D _AlphaTex; struct v2f { float4 pos : SV_POSITION; float3 uvMask : TEXCOORD0; }; v2f vert (appdata_img v) { v2f o; o.pos = UnityObjectToClipPos(v.vertex); // rescale default quad UVs to a -1 to +1 range so 0 is centered o.uvMask.xy = v.texcoord.xy * 2.0 - 1.0; // flip so bar is clockwise to be consistent with other examples o.uvMask.x = -o.uvMask.x; // calculate radian angle from progress bar value float angle = _Frac * (UNITY_PI * 2.0) - UNITY_PI; // get sine and cosine value for angle float sinX, cosX; sincos(angle, sinX, cosX); // construct 2D rotation matrix and rotate centered uvs to get angled mask float2x2 rotationMatrix = float2x2(cosX, -sinX, sinX, cosX); o.uvMask.z = mul(o.uvMask.xy, rotationMatrix).x; return o; } fixed4 frag (v2f i) : SV_Target { half diag = i.uvMask.z; half vert = i.uvMask.x; // sharpen masks with screen space derivates diag = i.uvMask.z / fwidth(i.uvMask.z); vert = i.uvMask.x / fwidth(i.uvMask.x); // \"flip\" the masks depending on progress bar value half barProgress = 0.0; if (_Frac  0.5) barProgress = max(diag, vert); else barProgress = min(diag, vert); // mask bottom of progress bar when below 20% if (_Frac  0.2 \u0026\u0026 i.uvMask.y  0.0) barProgress = 1.5; #if defined(SMOOTHSTEP) barProgress = smoothstep(0.25, 1.25, barProgress); #else barProgress = saturate(barProgress); #endif // lerp between colors fixed4 col = lerp(_FillColor, _BackColor, barProgress); fixed alpha = tex2D(_AlphaTex, i.uvMask.xy * 0.5 + 0.5).a; col.a *= alpha; return col; } ENDCG } Unpack Normal Any slight change in the channels will change the normal map’s result. DXT1’s RGB channels has 5,6,5 bits, respectively. The original value is 8 bits, so the precision is lost. DXT5 uses 5, 6, 5, 8 for RGBA channels. A is 8 bits and functions as R, G remains the same. B is calculated on the fly. Normal maps are normalized, so the recreated blue channel should be fine. This is called “swizzling” and it sacrificed one channel to giving less compression artifacts and better normal maps.\nMobile devices use unswizzled normal because sqrt is expensive.\nMore Discussion Thread:\n https://forum.unity.com/threads/question-about-normal-map-quality-and-channel-packing.527947/ https://forum.unity.com/threads/normal-map-looks-red-in-shader-graph.1071962/  Some Reading: https://substance3d.adobe.com/tutorials/courses/the-pbr-guide-part-1\n","wordCount":"753","inLanguage":"en","datePublished":"2021-11-08T00:01:24+08:00","dateModified":"2021-11-08T00:01:24+08:00","author":{"@type":"Person","name":"Kyle Fang"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://endfang.github.io/posts/ta_log_11082021/"},"publisher":{"@type":"Organization","name":"After1995","logo":{"@type":"ImageObject","url":"https://endfang.github.io/favicon.ico"}}}</script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://endfang.github.io accesskey=h title="After1995 (Alt + H)">
<img src=/apple-touch-icon.png alt=logo aria-label=logo height=35>After1995</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</span>
</div>
<ul id=menu>
<li>
<a href=https://endfang.github.io/archives/ title=archives>
<span>archives</span>
</a>
</li>
<li>
<a href=https://endfang.github.io/categories/ title=categories>
<span>categories</span>
</a>
</li>
<li>
<a href=https://endfang.github.io/tags/ title=tags>
<span>tags</span>
</a>
</li>
<li>
<a href=https://endfang.github.io/about/ title=about>
<span>about</span>
</a>
</li>
<li>
<a href=https://endfang.github.io/search/ title="search (Alt + /)" accesskey=/>
<span>search</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<div class=breadcrumbs><a href=https://endfang.github.io>Home</a>&nbsp;»&nbsp;<a href=https://endfang.github.io/posts/>Posts</a></div>
<h1 class=post-title>
TA Log 11082021
</h1>
<div class=post-meta>November 8, 2021&nbsp;·&nbsp;Kyle Fang
</div>
</header> <div class=toc>
<details open>
<summary accesskey=c title="(Alt + C)">
<span class=details>Table of Contents</span>
</summary>
<div class=inner><ul>
<li>
<a href=#circular-progress-bar aria-label="Circular Progress Bar">Circular Progress Bar</a><ul>
<li>
<a href=#atan-vs-atan2 aria-label="ATan vs. ATan2">ATan vs. ATan2</a></li>
<li>
<a href=#another-approach aria-label="Another approach">Another approach</a></li></ul>
</li>
<li>
<a href=#unpack-normal aria-label="Unpack Normal">Unpack Normal</a>
</li>
</ul>
</div>
</details>
</div>
<div class=post-content><p>Blom like an artist:</p>
<p><a href=https://letsgetvisualvisual.wordpress.com/2012/02/20/bloom-like-an-artist/>Bloom Like an Artist</a></p>
<h1 id=circular-progress-bar>Circular Progress Bar<a hidden class=anchor aria-hidden=true href=#circular-progress-bar>#</a></h1>
<p><a href=https://bgolus.medium.com/progressing-in-circles-13452434fdb9>https://bgolus.medium.com/progressing-in-circles-13452434fdb9</a></p>
<h2 id=atan-vs-atan2>ATan vs. ATan2<a hidden class=anchor aria-hidden=true href=#atan-vs-atan2>#</a></h2>
<p>$$
\tan{\alpha} = \frac{\sin{\alpha}}{\cos{\alpha}}
$$</p>
<p>and we have</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp>Quadrant    Angle              sin   cos   tan
-------------------------------------------------
  I           <span style=color:#ae81ff>0</span>    &lt; <span style=color:#960050;background-color:#1e0010>α</span> &lt; <span style=color:#960050;background-color:#1e0010>π</span>/<span style=color:#ae81ff>2</span>      +     +     +
  II          <span style=color:#960050;background-color:#1e0010>π</span>/<span style=color:#ae81ff>2</span>  &lt; <span style=color:#960050;background-color:#1e0010>α</span> &lt; <span style=color:#960050;background-color:#1e0010>π</span>        +     -     -
  III         <span style=color:#960050;background-color:#1e0010>π</span>    &lt; <span style=color:#960050;background-color:#1e0010>α</span> &lt; <span style=color:#ae81ff>3</span><span style=color:#960050;background-color:#1e0010>π</span>/<span style=color:#ae81ff>2</span>     -     -     +
  IV          <span style=color:#ae81ff>3</span><span style=color:#960050;background-color:#1e0010>π</span>/<span style=color:#ae81ff>2</span> &lt; <span style=color:#960050;background-color:#1e0010>α</span> &lt; <span style=color:#ae81ff>2</span><span style=color:#960050;background-color:#1e0010>π</span>       -     +     -
</code></pre></div><p>Only knowing tangent doesn&rsquo;t give exact quadrant, so we need atan2().</p>
<p>atan2(() takes 2 arguments, which is the projection of a vector with length v and angle $\alpha$ on the y and x axis</p>
<p>$$
y = v \cdot \sin{\alpha}
\<br>
x = v \cdot \cos{\alpha}
\<br>
y/x = \tan{\alpha}</p>
<p>$$</p>
<p>atan2() can tells 4 quadrant.</p>
<p>To implement a circular progress bar, we can use atan2().</p>
<p>First, we need to calculate UV to angle:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp>half angle = atan2(i.uv.x * -<span style=color:#ae81ff>2.0</span> + <span style=color:#ae81ff>1.0</span>, i.uv.y * -<span style=color:#ae81ff>2.0</span> + <span style=color:#ae81ff>1.0</span>);
</code></pre></div><p>This will make uv to 4 quadrants and calculate the current position&rsquo;s angle.</p>
<p>atan2() returns the radian between -pi to pi, we should convert angle into [0.0, 1.0].</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp>half range = angle / (UNITY_PI * <span style=color:#ae81ff>2.0</span>) + <span style=color:#ae81ff>0.5</span>;
</code></pre></div><p>Finally we can compare it with the progress value.</p>
<h2 id=another-approach>Another approach<a hidden class=anchor aria-hidden=true href=#another-approach>#</a></h2>
<p>Remap uv to -1 to +1 range so 0 is centered. Then we calculate progress to radian angle and create a rotation matrix.</p>
<p>The idea behind vertical and diagonal mask was to compare if the value is below 0. If it&rsquo;s below 0, then it is filled part.</p>
<p>To figure this out, think both vertical and diagonal masks as a complete image, not just one pixel. When I increase or decrease the progress, shader rotates the diagonal mask. By combining vertical and diagonal masks, some values will become zero.</p>
<p>It worth to mention that the rotation matrix in 2D is :</p>
<p>$$
\begin{bmatrix}</p>
<p>\cos{\theta} & \sin{\theta} \</p>
<p>-\sin{\theta} & \cos{\theta}</p>
<p>\end{bmatrix}
$$</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-glsl data-lang=glsl><span style=color:#960050;background-color:#1e0010>&#34;</span>CircularBarRotatedMask<span style=color:#960050;background-color:#1e0010>&#34;</span> {
    Properties {
        _Frac (<span style=color:#960050;background-color:#1e0010>&#34;</span>Progress Bar Value<span style=color:#960050;background-color:#1e0010>&#34;</span>, Range(<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>1</span>)) <span style=color:#f92672>=</span> <span style=color:#ae81ff>1.0</span>
        [NoScaleOffset] _AlphaTex (<span style=color:#960050;background-color:#1e0010>&#34;</span>Alpha<span style=color:#960050;background-color:#1e0010>&#34;</span>, <span style=color:#ae81ff>2</span>D) <span style=color:#f92672>=</span> <span style=color:#960050;background-color:#1e0010>&#34;</span>White<span style=color:#960050;background-color:#1e0010>&#34;</span> {}
        _FillColor (<span style=color:#960050;background-color:#1e0010>&#34;</span>Fill Color<span style=color:#960050;background-color:#1e0010>&#34;</span>, Color) <span style=color:#f92672>=</span> (<span style=color:#ae81ff>1</span>,<span style=color:#ae81ff>1</span>,<span style=color:#ae81ff>1</span>,<span style=color:#ae81ff>1</span>)
        _BackColor (<span style=color:#960050;background-color:#1e0010>&#34;</span>Back Color<span style=color:#960050;background-color:#1e0010>&#34;</span>, Color) <span style=color:#f92672>=</span> (<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>1</span>)
        [Toggle(SMOOTHSTEP)] _Smoothstep (<span style=color:#960050;background-color:#1e0010>&#34;</span>Use Smoothstep<span style=color:#960050;background-color:#1e0010>&#34;</span>, Float) <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.0</span>
    }

    SubShader {
        Tags {<span style=color:#960050;background-color:#1e0010>&#34;</span>Queue<span style=color:#960050;background-color:#1e0010>&#34;</span><span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>&#34;</span>Transparent<span style=color:#960050;background-color:#1e0010>&#34;</span> <span style=color:#960050;background-color:#1e0010>&#34;</span>IgnoreProjector<span style=color:#960050;background-color:#1e0010>&#34;</span><span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>&#34;</span>True<span style=color:#960050;background-color:#1e0010>&#34;</span> <span style=color:#960050;background-color:#1e0010>&#34;</span>RenderType<span style=color:#960050;background-color:#1e0010>&#34;</span><span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>&#34;</span>Transparent<span style=color:#960050;background-color:#1e0010>&#34;</span> <span style=color:#960050;background-color:#1e0010>&#34;</span>PreviewType<span style=color:#960050;background-color:#1e0010>&#34;</span><span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>&#34;</span>Plane<span style=color:#960050;background-color:#1e0010>&#34;</span>}

        ZWrite Off
        Blend SrcAlpha OneMinusSrcAlpha

        Pass {
            CGPROGRAM
            <span style=color:#960050;background-color:#1e0010>#</span>pragma vertex vert
            <span style=color:#960050;background-color:#1e0010>#</span>pragma fragment frag

            <span style=color:#960050;background-color:#1e0010>#</span>pragma shader_feature SMOOTHSTEP 

            <span style=color:#960050;background-color:#1e0010>#</span>include <span style=color:#960050;background-color:#1e0010>&#34;</span>UnityCG.cginc<span style=color:#960050;background-color:#1e0010>&#34;</span>

            <span style=color:#75715e>// Direct3D compiled stats:</span>
            <span style=color:#75715e>// vertex shader:</span>
            <span style=color:#75715e>//   12 math</span>
            <span style=color:#75715e>// fragment shader:</span>
            <span style=color:#75715e>//   13 math, 1 texture w/o smoothstep</span>
            <span style=color:#75715e>//   18 math, 1 texture w/ smoothstep</span>

            <span style=color:#66d9ef>half</span> _Frac;
            fixed4 _FillColor;
            fixed4 _BackColor;

            <span style=color:#66d9ef>sampler2D</span> _AlphaTex;

            <span style=color:#66d9ef>struct</span> v2f {
                float4 pos <span style=color:#f92672>:</span> SV_POSITION;
                float3 uvMask <span style=color:#f92672>:</span> TEXCOORD0;
            };

            v2f vert (appdata_img v)
            {
                v2f o;
                o.pos <span style=color:#f92672>=</span> UnityObjectToClipPos(v.vertex);

                <span style=color:#75715e>// rescale default quad UVs to a -1 to +1 range so 0 is centered</span>
                o.uvMask.xy <span style=color:#f92672>=</span> v.texcoord.xy <span style=color:#f92672>*</span> <span style=color:#ae81ff>2.0</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1.0</span>;

                <span style=color:#75715e>// flip so bar is clockwise to be consistent with other examples</span>
                o.uvMask.x <span style=color:#f92672>=</span> <span style=color:#f92672>-</span>o.uvMask.x;

                <span style=color:#75715e>// calculate radian angle from progress bar value</span>
                <span style=color:#66d9ef>float</span> angle <span style=color:#f92672>=</span> _Frac <span style=color:#f92672>*</span> (UNITY_PI <span style=color:#f92672>*</span> <span style=color:#ae81ff>2.0</span>) <span style=color:#f92672>-</span> UNITY_PI;

                <span style=color:#75715e>// get sine and cosine value for angle</span>
                <span style=color:#66d9ef>float</span> sinX, cosX;
                sincos(angle, sinX, cosX);

                <span style=color:#75715e>// construct 2D rotation matrix and rotate centered uvs to get angled mask</span>
                float2x2 rotationMatrix <span style=color:#f92672>=</span> float2x2(cosX, <span style=color:#f92672>-</span>sinX, sinX, cosX);
                o.uvMask.z <span style=color:#f92672>=</span> mul(o.uvMask.xy, rotationMatrix).x;

                <span style=color:#66d9ef>return</span> o;
            }

            fixed4 frag (v2f i) <span style=color:#f92672>:</span> SV_Target
            {
                <span style=color:#66d9ef>half</span> diag <span style=color:#f92672>=</span> i.uvMask.z;
                <span style=color:#66d9ef>half</span> vert <span style=color:#f92672>=</span> i.uvMask.x;

                <span style=color:#75715e>// sharpen masks with screen space derivates</span>
                diag <span style=color:#f92672>=</span> i.uvMask.z <span style=color:#f92672>/</span> fwidth(i.uvMask.z);
                vert <span style=color:#f92672>=</span> i.uvMask.x <span style=color:#f92672>/</span> fwidth(i.uvMask.x);

                <span style=color:#75715e>// &#34;flip&#34; the masks depending on progress bar value</span>
                <span style=color:#66d9ef>half</span> barProgress <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.0</span>;
                <span style=color:#66d9ef>if</span> (_Frac <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0.5</span>)
                    barProgress <span style=color:#f92672>=</span> max(diag, vert);
                <span style=color:#66d9ef>else</span>
                    barProgress <span style=color:#f92672>=</span> min(diag, vert);

                <span style=color:#75715e>// mask bottom of progress bar when below 20%</span>
                <span style=color:#66d9ef>if</span> (_Frac <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0.2</span> <span style=color:#f92672>&amp;&amp;</span> i.uvMask.y <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0.0</span>)
                    barProgress <span style=color:#f92672>=</span> <span style=color:#ae81ff>1.5</span>;

            <span style=color:#960050;background-color:#1e0010>#</span><span style=color:#66d9ef>if</span> <span style=color:#f92672>defined</span>(SMOOTHSTEP)
                barProgress <span style=color:#f92672>=</span> smoothstep(<span style=color:#ae81ff>0.25</span>, <span style=color:#ae81ff>1.25</span>, barProgress);
            <span style=color:#960050;background-color:#1e0010>#</span><span style=color:#66d9ef>else</span>
                barProgress <span style=color:#f92672>=</span> saturate(barProgress);
            <span style=color:#960050;background-color:#1e0010>#</span>endif

                <span style=color:#75715e>// lerp between colors</span>
                fixed4 col <span style=color:#f92672>=</span> lerp(_FillColor, _BackColor, barProgress);

                <span style=color:#66d9ef>fixed</span> alpha <span style=color:#f92672>=</span> tex2D(_AlphaTex, i.uvMask.xy <span style=color:#f92672>*</span> <span style=color:#ae81ff>0.5</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>0.5</span>).a;
                col.a <span style=color:#f92672>*=</span> alpha;

                <span style=color:#66d9ef>return</span> col;
            }
            ENDCG
        }
</code></pre></div><h1 id=unpack-normal>Unpack Normal<a hidden class=anchor aria-hidden=true href=#unpack-normal>#</a></h1>
<p>Any slight change in the channels will change the normal map&rsquo;s result. DXT1&rsquo;s RGB channels has 5,6,5 bits, respectively. The original value is 8 bits, so the precision is lost.
DXT5 uses 5, 6, 5, 8 for RGBA channels. A is 8 bits and functions as R, G remains the same. B is calculated on the fly. Normal maps are normalized, so the recreated blue channel should be fine. This is called &ldquo;swizzling&rdquo; and it sacrificed one channel to giving less compression artifacts and better normal maps.</p>
<p>Mobile devices use unswizzled normal because <code>sqrt</code> is expensive.</p>
<p>More Discussion Thread:</p>
<ol>
<li><a href=https://forum.unity.com/threads/question-about-normal-map-quality-and-channel-packing.527947/>https://forum.unity.com/threads/question-about-normal-map-quality-and-channel-packing.527947/</a></li>
<li><a href=https://forum.unity.com/threads/normal-map-looks-red-in-shader-graph.1071962/>https://forum.unity.com/threads/normal-map-looks-red-in-shader-graph.1071962/</a></li>
</ol>
<p>Some Reading: <a href=https://substance3d.adobe.com/tutorials/courses/the-pbr-guide-part-1>https://substance3d.adobe.com/tutorials/courses/the-pbr-guide-part-1</a></p>
</div>
<footer class=post-footer>
<a rel=license href=http://creativecommons.org/licenses/by-nc/4.0/>
<img alt="Creative Commons License" style=border-width:0 src=https://i.creativecommons.org/l/by-nc/4.0/88x31.png>
</a><p style=font-size:small>This work is licensed under a <a rel=license href=http://creativecommons.org/licenses/by-nc/4.0/>Creative Commons Attribution-NonCommercial 4.0 International License</a>.</p>
<br>
<ul class=post-tags>
<li><a href=https://endfang.github.io/tags/shader/>Shader</a></li>
<li><a href=https://endfang.github.io/tags/unity/>Unity</a></li>
</ul>
<nav class=paginav>
<a class=prev href=https://endfang.github.io/posts/ta_log_11292021/>
<span class=title>« Prev Page</span>
<br>
<span>TA Log 11292021</span>
</a>
<a class=next href=https://endfang.github.io/posts/ta_log_11012021/>
<span class=title>Next Page »</span>
<br>
<span>TA Log 11012021</span>
</a>
</nav>
</footer>
</article>
</main>
<footer class=footer>
<span>&copy; 2022 <a href=https://endfang.github.io>After1995</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
</body>
</html>